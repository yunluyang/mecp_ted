<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
<title>客户信息</title>
<link rel="stylesheet" href="../../../layuiadmin/layui/css/layui.css"
	media="all">
<link rel="stylesheet" href="../../../layuiadmin/style/admin.css"
	media="all">
<link type="text/css" rel="stylesheet"
	href="../../css/views/bdmapStyle.css">
<script type="text/javascript" src="../../js/jquery.min.js"></script>
<script type="text/javascript"
	src="http://api.map.baidu.com/api?v=2.0&ak=2COzFaICuIyVj7V3VetKfmdRVnX8BhVr"></script>

<style type="text/css">
body, html {
	width: 100%;
	height: 100%;
	margin: 0;
	font-family: "微软雅黑";
}

#allmap {
	height: 100%;
	width: 100%;
}

#r-result {
	width: 100%;
}
</style>
</head>
<body>
			<section class="section-bdmap">
				<div class="map-search">
					<!--/one-->
					<div class="one layui-form">
						<label class="option">客户地区</label> <select id="select_property">
						<option value="1">江苏</option>
					<option value="2">海南</option>
					<option value="3">青岛</option>
						</select>
					</div>
					<!--/one-->
					<div class="one layui-form">
						<label class="option">客户姓名</label> <select id="select_property">
							<option value="1">青岛天能重工股份有限公司</option>
					<option value="2">青海立腾新能源投资有限公司</option>
					<option value="3">通威新能源有限公司</option>
					<option value="4">顺风光电投资（中国）有限公司</option>
					<option value="5">中民能控有限公司</option>
						</select>
					</div>
					<!--/one-->
				</div>
				<!--/map-search-->
			</section>
			<!--/map-bdmap-->

			<section id="allmap"></section>
			<!--百度地图展示区域-->
</body>
	<script src="../../../layuiadmin/layui/layui.js"></script>
<script>
	var markers = [];
	// 百度地图API功能
	var map = new BMap.Map("allmap");
	function myFun(result){
		var cityName = result.name;
		map.setCenter(cityName);
	}
	var myCity = new BMap.LocalCity();
	myCity.get(myFun);
	map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);
	var top_left_control = new BMap.ScaleControl({
		anchor : BMAP_ANCHOR_TOP_LEFT
	});// 左上角，添加比例尺
	var top_left_navigation = new BMap.NavigationControl(); //左上角，添加默认缩放平移控件
	var top_right_navigation = new BMap.NavigationControl({
		anchor : BMAP_ANCHOR_TOP_RIGHT,
		type : BMAP_NAVIGATION_CONTROL_SMALL
	}); //右上角，仅包含平移和缩放按钮
	map.addControl(top_left_control);
	map.addControl(top_left_navigation);
	map.addControl(top_right_navigation);
	map.enableScrollWheelZoom();

	var opts = {
			width : 250,     // 信息窗口宽度
			height: 80,     // 信息窗口高度
			title : "信息窗口" , // 信息窗口标题
			enableMessage:true//设置允许信息窗发送短息
		   };
	   
	function addMarker(point){
		  var marker = new BMap.Marker(point);
		  map.addOverlay(marker);
		}

	function addClickHandler(content,marker){
		marker.addEventListener("click",function(e){
			openInfo(content,e)}
		);
	}
	function openInfo(content,e){
		var p = e.target;
		var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
		var infoWindow = new BMap.InfoWindow(content,opts);  // 创建信息窗口对象 
		map.openInfoWindow(infoWindow,point); //开启信息窗口
	};
		layui.config({
			base : '../../../layuiadmin/' //静态资源所在路径
		}).extend({
			index : 'lib/index' //主入口模块
		}).use(
				[ 'index', 'form','table' ],
				function() {
					var admin = layui.admin, table = layui.table;
					table.render({
						elem : '#test-table-onrow',
						 even: true, //开启隔行背景
						 height: '200px',
						url : '../../common/getCustomers',
						cols : [ [ {
							field : 'id',
							width : 30,
							title : '序号',
							sort : true
						}, {
							field : 'customer_name',
							title : '电站名称',
							sort : true
						}, {
							field : 'customer_address',
							title : '地址',
							sort : true
						}, {
							field : 'customer_contact_name',
							title : '联系人',
							sort : true
						}, {
							field : 'customer_contact',
							title : '联系方式',
							sort : true
						} ] ]
					,
				      done : function(res, curr, count){
				          // do something...
				      
				      }
					,
						page : true
					});
					//监听行单击事件（单击事件为：rowDouble）
					table.on('row(test-table-onrow)', function(obj) {
						var data = obj.data;
						map.centerAndZoom(new BMap.Point(data.long, data.lat), 11);
						//标注选中样式
						obj.tr.addClass('layui-table-click').siblings()
								.removeClass('layui-table-click');
					});
				});

		$.get("../../common/getListCustomers",function(data,status){
			data.data.forEach(function(item){
	        	  var point = new BMap.Point(item.long, item.lat);
	        	  var marker = new BMap.Marker(new BMap.Point(item.long,item.lat));  // 创建标注
	      			var content = item.customer_name+",地址:"+item.customer_address+",联系人:"+item.customer_contact_name+",联系方式:"+item.customer_contact;
	      				map.addOverlay(marker);               // 将标注添加到地图中
	      			addClickHandler(content,marker);
	      			markers.push(marker);
					});
	        //最简单的用法，生成一个marker数组，然后调用markerClusterer类即可。
	      	var markerClusterer = new BMapLib.MarkerClusterer(map, {markers:markers});
			
			});
	</script>
</html>

